!function(a){function e(a){if(a.rockets.length<b){var c=new h(a);a.rockets.push(c)}}function f(a){e(a),a.canvas_width!=a.element.offsetWidth&&(a.canvas_width=a.canvas.width=a.canvas_buffer.width=a.element.offsetWidth),a.canvas_height!=a.element.offsetHeight&&(a.canvas_height=a.canvas.height=a.canvas_buffer.height=a.element.offsetHeight),a.context_buffer.clearRect(0,0,a.canvas.width,a.canvas.height),a.context_buffer.globalAlpha=.9,a.context_buffer.drawImage(a.canvas,0,0),a.context.clearRect(0,0,a.canvas.width,a.canvas.height),a.context.drawImage(a.canvas_buffer,0,0);var b=[];a.rockets.forEach(function(c){c.update(),c.render(a.context);var d=c.pos.y<2*a.canvas.height/3?100*Math.random()<=1:!1;c.pos.y<a.canvas.height/5||c.vel.y>=0||d?c.explode(a):b.push(c)}),a.rockets=b;var d=[];for(a.particles.forEach(function(b){b.update(),b.exists()&&(b.render(a.context),d.push(b))}),a.particles=d;a.particles.length>c;)a.particles.shift()}function g(a){this.pos={x:a?a.x:0,y:a?a.y:0},this.vel={x:0,y:0},this.shrink=.97,this.size=2,this.resistance=1,this.gravity=0,this.flick=!1,this.alpha=1,this.fade=0,this.color=0}function h(a){g.apply(this,[{x:Math.random()*a.canvas.width*2/3+a.canvas.width/6,y:a.canvas.height}]),this.explosionColor=10*Math.floor(360*Math.random()/10),this.vel.y=-3*Math.random()-4,this.vel.x=6*Math.random()-3,this.size=2,this.shrink=.999,this.gravity=.01}var b=5,c=500,d={init:function(b){var c=a(b);if(void 0!==c.data("fireworks_data"))return void console.log("Looks like this element is already inited!");var d=document.createElement("canvas"),e=document.createElement("canvas"),g={element:b,canvas:d,context:d.getContext("2d"),canvas_buffer:e,context_buffer:e.getContext("2d"),particles:[],rockets:[]};"static"===c.css("position")&&(b.style.position="relative"),b.appendChild(d),d.style.position="absolute",d.style.top="0px",d.style.bottom="0px",d.style.left="0px",d.style.right="0px",g.interval=setInterval(f.bind(this,g),20),c.data("fireworks_data",g)},destroy:function(b){var c=a(b);if(void 0===c.data("fireworks_data"))return void console.log("Looks like this element is not yet inited!");var d=c.data("fireworks_data");c.removeData("fireworks_data"),clearInterval(d.interval),d.canvas.remove(),d.element.style.position=""}};a.fn.fireworks=function(a){return a||(a="init"),this.each(function(){d[a](this)}),this},g.prototype.update=function(){this.vel.x*=this.resistance,this.vel.y*=this.resistance,this.vel.y+=this.gravity,this.pos.x+=this.vel.x,this.pos.y+=this.vel.y,this.size*=this.shrink,this.alpha-=this.fade},g.prototype.render=function(a){if(this.exists()){a.save(),a.globalCompositeOperation="lighter";var b=this.pos.x,c=this.pos.y,d=this.size/2,e=a.createRadialGradient(b,c,.1,b,c,d);e.addColorStop(.1,"rgba(255,255,255,"+this.alpha+")"),e.addColorStop(.8,"hsla("+this.color+", 100%, 50%, "+this.alpha+")"),e.addColorStop(1,"hsla("+this.color+", 100%, 50%, 0.1)"),a.fillStyle=e,a.beginPath(),a.arc(this.pos.x,this.pos.y,this.flick?Math.random()*this.size:this.size,0,2*Math.PI,!0),a.closePath(),a.fill(),a.restore()}},g.prototype.exists=function(){return this.alpha>=.1&&this.size>=1},h.prototype=new g,h.prototype.constructor=h,h.prototype.explode=function(a){for(var b=10*Math.random()+80,c=0;c<b;c++){var d=new g(this.pos),e=Math.random()*Math.PI*2,f=15*Math.cos(Math.random()*Math.PI/2);d.vel.x=Math.cos(e)*f,d.vel.y=Math.sin(e)*f,d.size=10,d.gravity=.2,d.resistance=.92,d.shrink=.05*Math.random()+.93,d.flick=!0,d.color=this.explosionColor,a.particles.push(d)}},h.prototype.render=function(a){if(this.exists()){a.save(),a.globalCompositeOperation="lighter";var b=this.pos.x,c=this.pos.y,d=this.size/2,e=a.createRadialGradient(b,c,.1,b,c,d);e.addColorStop(.1,"rgba(255, 255, 255 ,"+this.alpha+")"),e.addColorStop(.2,"rgba(255, 180, 0, "+this.alpha+")"),a.fillStyle=e,a.beginPath(),a.arc(this.pos.x,this.pos.y,this.flick?Math.random()*this.size/2+this.size/2:this.size,0,2*Math.PI,!0),a.closePath(),a.fill(),a.restore()}}}(jQuery);